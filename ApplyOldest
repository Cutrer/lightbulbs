import openpyxl

def clear_debits_credits(workbook_file):
    # Load the workbook
    wb = openpyxl.load_workbook(workbook_file)

    # Select the sheets that contain debits and credits
    debits_sheet = wb['Debits']
    credits_sheet = wb['Credits']
    cleared_sheet = wb.create_sheet(title="Cleared Debits")

    # Define the starting row for each sheet
    debits_start_row = 2
    credits_start_row = 2
    cleared_start_row = 2

    # Get the number of rows in the debits and credits sheets
    debits_rows = debits_sheet.max_row
    credits_rows = credits_sheet.max_row

    # Keep track of the remaining credit balance
    credit_balance = 0

    # Loop through each debit
    for debits_row in range(debits_start_row, debits_rows+1):
        debit_amount = debits_sheet.cell(row=debits_row, column=2).value

        # If there is a credit balance, use it to clear the debit
        if credit_balance > 0:
            if credit_balance >= debit_amount:
                credit_balance -= debit_amount
                cleared_sheet.cell(row=cleared_start_row, column=1).value = debits_sheet.cell(row=debits_row, column=1).value
                cleared_sheet.cell(row=cleared_start_row, column=2).value = debit_amount
                cleared_start_row += 1
            else:
                debit_amount -= credit_balance
                cleared_sheet.cell(row=cleared_start_row, column=1).value = debits_sheet.cell(row=debits_row, column=1).value
                cleared_sheet.cell(row=cleared_start_row, column=2).value = credit_balance
                cleared_start_row += 1
                credit_balance = 0

        # If there is no credit balance, find the oldest available credit to apply to the debit
        while credit_balance < debit_amount and credits_start_row <= credits_rows:
            credit_amount = credits_sheet.cell(row=credits_start_row, column=2).value
            credit_balance += credit_amount
            credits_start_row += 1

    # Save the workbook
    wb.save(workbook_file)

# Example usage:
clear_debits_credits("debits_credits.xlsx")
